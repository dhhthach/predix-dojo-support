<link rel="import" href="../../bower_components/google-map/google-map.html">
<link rel="import" href="../satellite-legends/satellite-legends.html">

<link rel="import" href="">

<dom-module id="dt-knowledge-map">
    <template>
        <style>
            #infoWindow{
                position: absolute;
                z-index: 2;
                max-width: 150px;
                max-height: 100px;
                background: white;
                width: 150px;
                height: 100px;
                border-radius: 1em;
                font-size: 9px;
                padding: 10px;
                text-align: center;
                display: none;
                left: 35%;
                box-shadow: 0px 15px 15px -12px rgba(0,0,0,0.75);
                top: 5em;
            }
        </style>

        <div id="infoWindow">
            <p>{{infoContent}}</p>
        </div>

        <google-map id="gmap" mapTypeId="hybrid" zoom=2 latitude="20" longitude="5" style="width: calc(100% - 250px)">
            
            <template is="dom-repeat" items="{{engines}}"> <!--{{getIcon(item.type)}}-->
                <google-map-marker 
                    data="{{item}}" 
                    click-events="true" 
                    mouse-events="true"
                    on-google-map-marker-click="onEngineClick" 
                    on-google-map-marker-mouseover="onEngineHover"
                    on-google-map-marker-mouseout="onEngineOut"
                    icon={{getIcon(item)}} 
                    latitude="{{item.location.lat}}" 
                    longitude="{{item.location.lng}}"
                    title={{item.description}}>
                </google-map-marker>
            </template>

        </google-map>
        <!--<satellite-legends></satellite-legends>-->
    </template>
    <script>
        Polymer({
            is: 'dt-knowledge-map',
            properties: {
                engines: {
                    type: Array,
                    value: []
                },
                mapOptions: {
                    type: Object,
                    value: {
                        mapTypeId: "hybrid",
                        labels: true,
                        backgroundColor: "rgb(11,18,26)",
                        disableDoubleClickZoom: true,
                        streetViewControl: false
                    }
                },
                infoContent:{
                    type: String,
                    value: ""
                }
            },

            attached: function() {
              var _this = this;
              document.getElementById('seedApp').addEventListener('routeChanged', function(e) {
                    google.maps.event.trigger(_this.$.gmap.map, 'resize');
                });
            },

            markerColorFromEngineType: function(type) {
                return type == 'SolarPVSystem' ? 'yellow' : 'blue';
            },
            onEngineClick: function(e) {
                seedApp.setRoute(e.target.data.uri.substring(1));
            },
            onEngineHover: function(e){
                document.getElementById("infoWindow").style.display="block"
                this.infoContent = "Manufacturer: "+e.model.get('item.manufactuer')
                this.infoContent += "\nModel No: "+e.model.get('item.modelNumber')
            },
            onEngineOut: function(e){
                document.getElementById("infoWindow").style.display="none"
            },
            getIcon: function(item) {
                var url;

                var icon = null;

                // if (item.flag) {
                //     icon = 'red';
                // } else {
                //     icon = 'green';
                // }

                if(item.manufactuer==="Cummins")
                    icon = 'red';
                else
                    icon = 'green';

                icon = icon + '-square-pin.png';

                url = '/images/map-pins/'+icon;

                return {
                    url: url
                };
            }
        });
    </script>
</dom-module>
